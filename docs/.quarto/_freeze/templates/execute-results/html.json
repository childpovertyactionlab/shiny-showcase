{
  "hash": "f8871282bc335177ad6ca82d9fca7f7a",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Templates\"\nsubtitle: \"Ready-to-use starter files for CPAL Shiny apps\"\n---\n\n\n## Overview\n\nThese templates provide a starting point for building CPAL-branded Shiny applications. Copy them to your project and modify as needed.\n\n## App Template\n\nThe main application template includes everything you need to get started:\n\n- CPAL dashboard theme integration\n- Header with logo and dark/light mode toggle\n- Loading spinner for initialization\n- Sidebar with filter controls\n- Sample ggplot2 charts with CPAL theming\n- Reactive data filtering\n\n### Usage\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# 1. Copy templates/app-template.R to your project as app.R\n# 2. Run the brand setup function\ncpaltemplates::use_cpal_brand()\n\n# 3. Copy the header and loading spinner templates\n# 4. Run your app!\n```\n:::\n\n\n### Full Template\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# CPAL Shiny App Template\n# A minimal starting point for CPAL-branded Shiny applications\n#\n# Setup Instructions:\n# 1. Copy this file to your new project as app.R\n# 2. Run use_cpal_brand() to copy _brand.yml to your project\n# 3. Copy templates/header-template.R to views/header-ui.R\n# 4. Copy templates/loading-spinner-template.R to R/loading-spinner.R\n# 5. Place CPAL logo in www/images/CPAL_Logo_OneColor.png\n# 6. Modify as needed for your project\n\n# ============================================================================\n# LOAD PACKAGES\n# ============================================================================\n\nlibrary(shiny)\nlibrary(shinyjs)\nlibrary(bslib)\nlibrary(bsicons)\nlibrary(ggplot2)\nlibrary(dplyr)\nlibrary(thematic)\nlibrary(cpaltemplates)\n\n# Optional packages (uncomment as needed):\n# library(shinyWidgets)  # Enhanced input widgets\n# library(gt)            # Publication-ready tables\n# library(reactable)     # Interactive tables\n# library(DT)            # DataTables\n# library(highcharter)   # Interactive charts\n# library(mapgl)         # Mapbox maps\n# library(sf)            # Spatial data\n\n# ============================================================================\n# CONFIGURATION\n# ============================================================================\n\n# Suppress Shiny dev mode popups (e.g., GT shared ID warnings)\noptions(shiny.devmode = FALSE)\n\n# Environment variables (use .env file for sensitive tokens in production)\n# Sys.setenv(MY_API_TOKEN = \"your-token-here\")\n\n# Source helper files\nsource(\"R/loading-spinner.R\")\n\n# ============================================================================\n# LOAD DATA\n# ============================================================================\n\n# Option 1: Load from local files\n# your_data <- readRDS(\"data/your_data.rds\")\n\n# Option 2: Connect to database (e.g., Databricks)\n# con <- DBI::dbConnect(...)\n# your_data <- DBI::dbGetQuery(con, \"SELECT * FROM your_table\")\n\n# Sample data for template demo (replace with your data)\nsample_data <- data.frame(\n  category = rep(LETTERS[1:4], each = 25),\n  value = c(rnorm(25, 10, 2), rnorm(25, 15, 3),\n            rnorm(25, 12, 2.5), rnorm(25, 18, 4)),\n  group = sample(c(\"Group 1\", \"Group 2\"), 100, replace = TRUE)\n)\n\n# ============================================================================\n# USER INTERFACE\n# ============================================================================\n\nui <- page_sidebar(\n  # Header with logo and dark mode toggle\n  title = source(\"views/header-ui.R\")$value,\n\n  # Apply CPAL dashboard theme (reads from _brand.yml)\n  theme = cpal_dashboard_theme(),\n\n  # Sidebar navigation/filters\n  sidebar = sidebar(\n    title = \"Filters\",\n\n    # Add your filter inputs here\n    selectInput(\n      \"category_filter\",\n      \"Category:\",\n      choices = c(\"All\", LETTERS[1:4]),\n      selected = \"All\"\n    ),\n\n    sliderInput(\n      \"value_range\",\n      \"Value Range:\",\n      min = 0,\n      max = 30,\n      value = c(0, 30)\n    ),\n\n    hr(),\n\n    # Action buttons\n    actionButton(\"apply_filters\", \"Apply Filters\", class = \"btn-primary w-100\"),\n    actionButton(\"reset_filters\", \"Reset\", class = \"btn-outline-secondary w-100 mt-2\")\n  ),\n\n  # Enable shinyjs for UI interactions\n  useShinyjs(),\n\n  # Loading overlay (shows during initialization)\n  loading_overlay_ui(message = \"Loading application...\"),\n\n  # -------------------------------------------------------------------------\n  # MAIN CONTENT AREA\n  # -------------------------------------------------------------------------\n\n  # Page title\n  h1(\"Dashboard Title\"),\n  p(\"Dashboard description or instructions.\", class = \"lead text-muted\"),\n\n  # Content layout using bslib cards\n  layout_columns(\n    col_widths = c(6, 6),\n\n    # Chart 1\n    card(\n      card_header(\"Chart Title 1\"),\n      card_body(\n        plotOutput(\"chart1\", height = \"300px\")\n      )\n    ),\n\n    # Chart 2\n    card(\n      card_header(\"Chart Title 2\"),\n      card_body(\n        plotOutput(\"chart2\", height = \"300px\")\n      )\n    )\n  ),\n\n  # Additional content row\n  layout_columns(\n    col_widths = 12,\n\n    card(\n      card_header(\"Data Table\"),\n      card_body(\n        # Add your table output here\n        # gt_output(\"my_table\")\n        p(\"Table content goes here\")\n      )\n    )\n  )\n)\n\n# ============================================================================\n# SERVER LOGIC\n# ============================================================================\n\nserver <- function(input, output, session) {\n\n  # --------------------------------------------------------------------------\n  # INITIALIZATION\n  # --------------------------------------------------------------------------\n\n  # Enable thematic for auto dark/light mode in ggplot2\n  thematic::thematic_on()\n\n  # Setup loading overlay (hides after fonts load)\n  setup_loading_overlay(session, setup_fonts = TRUE)\n\n  # --------------------------------------------------------------------------\n  # REACTIVE DATA\n  # --------------------------------------------------------------------------\n\n  filtered_data <- reactive({\n    data <- sample_data\n\n    # Apply filters\n    if (input$category_filter != \"All\") {\n      data <- data %>% filter(category == input$category_filter)\n    }\n\n    data <- data %>%\n      filter(value >= input$value_range[1],\n             value <= input$value_range[2])\n\n    data\n  })\n\n  # --------------------------------------------------------------------------\n  # OUTPUTS\n  # --------------------------------------------------------------------------\n\n  # Chart 1: Bar chart\n  output$chart1 <- renderPlot({\n    filtered_data() %>%\n      count(category) %>%\n      ggplot(aes(x = category, y = n, fill = category)) +\n      geom_col() +\n      scale_fill_cpal_d() +\n      labs(\n        title = \"Count by Category\",\n        x = NULL,\n        y = \"Count\"\n      ) +\n      theme_cpal_auto() +\n      theme(legend.position = \"none\")\n  })\n\n  # Chart 2: Box plot\n  output$chart2 <- renderPlot({\n    ggplot(filtered_data(), aes(x = group, y = value, fill = group)) +\n      geom_boxplot(alpha = 0.8) +\n      scale_fill_cpal_d() +\n      labs(\n        title = \"Value Distribution by Group\",\n        x = NULL,\n        y = \"Value\"\n      ) +\n      theme_cpal_auto() +\n      theme(legend.position = \"none\")\n  })\n\n  # --------------------------------------------------------------------------\n  # EVENT HANDLERS\n  # --------------------------------------------------------------------------\n\n  # Reset filters\n  observeEvent(input$reset_filters, {\n    updateSelectInput(session, \"category_filter\", selected = \"All\")\n    updateSliderInput(session, \"value_range\", value = c(0, 30))\n    showNotification(\"Filters reset!\", type = \"message\", duration = 2)\n  })\n}\n\n# ============================================================================\n# RUN APPLICATION\n# ============================================================================\n\nshinyApp(ui = ui, server = server)\n```\n:::\n\n\n::: {.callout-tip}\n## Download Template\nView the complete template at [templates/app-template.R](https://github.com/childpovertyactionlab/cpal-shiny-showcase/blob/main/templates/app-template.R)\n:::\n\n## Header Template\n\nA reusable header component with the CPAL logo and dark/light mode toggle.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# CPAL Shiny Header Template\n# Copy this file to your project's views/ folder and modify as needed\n#\n# Usage in app.R:\n#   ui <- page_sidebar(\n#     title = source(\"views/header-ui.R\")$value,\n#     ...\n#   )\n\nheader_ui <- div(\n  class = \"d-flex align-items-center justify-content-between w-100\",\n\n\n  # Left side: logo + title\n  # Modify the title text and logo path for your project\n  div(\n    class = \"d-flex align-items-center\",\n    tags$img(\n      src = \"images/CPAL_Logo_OneColor.png\",  # Place logo in www/images/\n      height = \"30\",\n      class = \"me-2\"\n    ),\n    tags$div(\"Your Dashboard Title\", class = \"header-title\")  # <- MODIFY THIS\n  ),\n\n  # Right side: dark mode toggle\n\n# Options for mode: \"light\" (default light), \"dark\" (default dark), NULL (system preference)\n  input_dark_mode(id = \"dark_mode_toggle\", mode = \"light\")\n)\n```\n:::\n\n\n### Header Features\n\n- **Logo**: Displays CPAL logo from `www/images/`\n- **Title**: Application name with navigation link\n- **Dark Mode Toggle**: Automatic theme switching via `bslib::input_dark_mode()`\n- **Mode Default**: Set to `mode = \"light\"` for light mode start\n\n## Loading Spinner Template\n\nProvides visual feedback during app initialization, especially useful when loading Google Fonts or large datasets.\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# CPAL Shiny Loading Spinner Template\n# Copy this file to your project's R/ folder and source it in your app\n#\n# Usage in app.R UI section:\n#   source(\"R/loading-spinner.R\")\n#   ui <- page_sidebar(\n#     ...\n#     useShinyjs(),\n#     loading_overlay_ui(),  # Add this after useShinyjs()\n#     ...\n#   )\n#\n# Usage in app.R server section:\n#   server <- function(input, output, session) {\n#     # Call this at the start of your server function\n#     setup_loading_overlay(session)\n#     ...\n#   }\n\n# UI Component: Loading overlay with spinner\n# Customize the message and styling as needed\nloading_overlay_ui <- function(\n    message = \"Loading application...\",\n    spinner_color = \"text-primary\",\n    background = \"rgba(255,255,255,0.9)\"\n) {\n  div(\n    id = \"loading_overlay\",\n    class = \"loading-overlay\",\n    style = paste0(\n      \"position: fixed; top: 0; left: 0; width: 100%; height: 100%;\n       background: \", background, \"; z-index: 9999;\n       display: flex; justify-content: center; align-items: center;\n       flex-direction: column;\"\n    ),\n    div(\n      class = paste(\"spinner-border\", spinner_color),\n      role = \"status\",\n      style = \"width: 3rem; height: 3rem;\"\n    ),\n    p(message, class = \"mt-3 text-muted\", style = \"font-size: 1.1rem;\")\n  )\n}\n\n# Server Component: Hide loading overlay after initialization\n# Optionally setup CPAL Google Fonts (set setup_fonts = FALSE to skip)\nsetup_loading_overlay <- function(session, setup_fonts = TRUE) {\n  session$onFlushed(function() {\n    # Optional: Setup CPAL Google Fonts (can be slow on first load)\n    if (setup_fonts && exists(\"setup_cpal_google_fonts\")) {\n      setup_cpal_google_fonts()\n    }\n\n    # Hide the loading overlay with fade animation\n    shinyjs::hide(\"loading_overlay\", anim = TRUE, animType = \"fade\")\n  }, once = TRUE)\n}\n```\n:::\n\n\n### Loading Spinner Features\n\n- **Overlay UI**: Full-page overlay that blocks interaction during load\n- **Custom Message**: Configurable loading message\n- **Font Loading**: Option to set up CPAL Google Fonts\n- **Deferred Hide**: Uses `session$onFlushed()` to ensure UI is ready\n\n### Usage in Your App\n\n**In UI:**\n\n::: {.cell}\n\n```{.r .cell-code}\nui <- page_sidebar(\n  # ... other UI elements\n  useShinyjs(),\n  loading_overlay_ui(message = \"Loading application...\")\n)\n```\n:::\n\n\n**In Server:**\n\n::: {.cell}\n\n```{.r .cell-code}\nserver <- function(input, output, session) {\n  setup_loading_overlay(session, setup_fonts = TRUE)\n  # ... rest of server logic\n}\n```\n:::\n\n\n## Quick Start Checklist\n\n1. [ ] Copy `templates/app-template.R` to your project as `app.R`\n2. [ ] Run `cpaltemplates::use_cpal_brand()` to create `_brand.yml`\n3. [ ] Copy `templates/header-template.R` to `views/header-ui.R`\n4. [ ] Copy `templates/loading-spinner-template.R` to `R/loading-spinner.R`\n5. [ ] Place CPAL logo in `www/images/CPAL_Logo_OneColor.png`\n6. [ ] Create `.env` file for any API tokens (add to `.gitignore`)\n7. [ ] Run `shiny::runApp()` to test\n\n## File Locations\n\n| Template | Copy To | Purpose |\n|----------|---------|---------|\n| `app-template.R` | `app.R` | Main application |\n| `header-template.R` | `views/header-ui.R` | Header component |\n| `loading-spinner-template.R` | `R/loading-spinner.R` | Loading overlay |\n\n## Customization Tips\n\n### Changing the Logo\n\nReplace the logo path in `header-template.R`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntags$img(\n  src = \"images/your-logo.png\",  # Change this path\n  height = \"40px\",\n  alt = \"Your Organization\"\n)\n```\n:::\n\n\n### Modifying the Theme\n\nThe dashboard theme is loaded from `_brand.yml`. To customize colors, edit `_brand.yml` or pass options to `cpal_dashboard_theme()`:\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntheme = cpal_dashboard_theme(\n  # Override specific settings if needed\n)\n```\n:::\n\n\n### Adding Sidebar Sections\n\nExtend the sidebar with additional filter groups:\n\n\n::: {.cell}\n\n```{.r .cell-code}\nsidebar = sidebar(\n  title = \"Filters\",\n\n  # Section 1\n  h6(\"Demographics\"),\n  selectInput(\"age_group\", \"Age Group:\", choices = c(\"All\", \"0-5\", \"6-12\")),\n\n  hr(),\n\n  # Section 2\n  h6(\"Geography\"),\n  selectInput(\"region\", \"Region:\", choices = regions)\n)\n```\n:::\n",
    "supporting": [],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}